<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Table</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #2c3e50;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            overflow: hidden;
            animation: slideIn 0.8s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .summary-section {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 25px 30px;
            margin: 0;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .summary-card {
            background: rgba(255, 255, 255, 0.15);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: center;
            transition: all 0.3s ease;
        }

        .summary-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.25);
        }

        .summary-card h3 {
            font-size: 0.9rem;
            margin-bottom: 10px;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .summary-card .value {
            font-size: 1.8rem;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        .summary-card        .vnd-value {
            font-size: 1.1rem;
            font-weight: 600;
            margin-top: 5px;
            opacity: 0.9;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .vnd-value::before {
            content: '≈ ';
            font-size: 0.9rem;
            opacity: 0.7;
        }

        .portfolio-table {
            margin: 30px;
            overflow-x: auto;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 15px;
            overflow: hidden;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 10px;
            text-align: center;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        td {
            padding: 12px 10px;
            text-align: center;
            border-bottom: 1px solid #eee;
            font-size: 0.9rem;
            vertical-align: middle;
        }

        tr:hover {
            background: #f8f9ff;
            transform: scale(1.02);
            transition: all 0.2s ease;
        }

        .symbol {
            font-weight: bold;
            font-size: 1rem;
            color: #2c3e50;
        }

        .crypto-name {
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-top: 2px;
        }

        .positive {
            color: #27ae60;
            font-weight: bold;
        }

        .negative {
            color: #e74c3c;
            font-weight: bold;
        }

        .neutral {
            color: #95a5a6;
        }

        .trend-bullish {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .trend-strong-bullish {
            background: linear-gradient(135deg, #27ae60, #1e8449);
            color: white;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.9rem; /* Adjusted size */
            font-weight: bold;
            text-transform: uppercase;
            box-shadow: 0 0 10px rgba(39, 174, 96, 0.5);
        }

        .trend-bearish {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .trend-strong-bearish {
            background: linear-gradient(135deg, #c0392b, #a93226);
            color: white;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.9rem; /* Adjusted size */
            font-weight: bold;
            text-transform: uppercase;
            box-shadow: 0 0 10px rgba(192, 57, 43, 0.5);
        }

        .trend-sideways {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .trend-slightly-bullish {
            background: linear-gradient(135deg, #1e8449, #145a32);
            color: white;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
            box-shadow: 0 0 15px rgba(30, 132, 73, 0.6);
        }

        .trend-slightly-bearish {
            background: linear-gradient(135deg, #a93226, #922b21);
            color: white;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
            box-shadow: 0 0 15px rgba(169, 50, 38, 0.6);
        }

        .trend-unknown {
            background: #95a5a6;
            color: white;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .risk-low {
            background: #2ecc71;
            color: white;
            padding: 3px 6px;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .risk-medium {
            background: #f39c12;
            color: white;
            padding: 3px 6px;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .risk-high {
            background: #e74c3c;
            color: white;
            padding: 3px 6px;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .risk-very_high {
            background: #8e44ad;
            color: white;
            padding: 3px 6px;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .risk-critical {
            background: #c0392b;
            color: white;
            padding: 3px 6px;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: bold;
            animation: blink 1s infinite;
        }

        .risk-unknown {
            background: #95a5a6;
            color: white;
            padding: 3px 6px;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: bold;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.5; }
        }

        .recommendation {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: bold;
            text-transform: uppercase;
            white-space: nowrap;
        }

        .rec-hold { background: #3498db; color: white; }
        .rec-buy { background: #2ecc71; color: white; }
        .rec-sell { background: #e74c3c; color: white; }
        .rec-wait { background: #f39c12; color: white; }
        .rec-profit { background: #9b59b6; color: white; }
        .rec-take-major-profit { background: #8e44ad; color: white; }
        .rec-take-partial-profit { background: #9b59b6; color: white; }
        .rec-consider-stop-loss { background: #e67e22; color: white; }
        .rec-urgent-review-consider-exit { background: #c0392b; color: white; animation: blink 1s infinite; }
        .rec-near-target-consider-sell { background: #f39c12; color: white; }
        .rec-far-from-target-monitor { background: #95a5a6; color: white; }
        .rec-overbought-wait-for-dip { background: #e74c3c; color: white; }
        .rec-oversold-consider-buying { background: #27ae60; color: white; }
        .rec-review { background: #34495e; color: white; }

        .footer {
            background: #34495e;
            color: white;
            text-align: center;
            padding: 20px;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .technical-indicators {
            font-size: 0.8rem;
            line-height: 1.3;
            font-weight: bold;
        }

        .price-levels {
            font-size: 0.8rem;
            line-height: 1.3;
            font-weight: bold;
        }

        .price-levels .support {
            color: #3498db;
        }

        .price-levels .resistance {
            color: #e74c3c;
        }

        .price-levels .stop-loss {
            color: #f39c12;
        }

        .price-levels .take-profit {
            color: #2ecc71;
        }

        .price-cell {
            font-weight: bold;
            font-size: 0.95rem;
        }

        .percentage-cell {
            font-weight: bold;
        }

        .value-cell {
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }

            .header h1 {
                font-size: 1.8rem;
            }

            .summary-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .portfolio-table {
                margin: 15px;
            }

            th, td {
                padding: 8px 5px;
                font-size: 0.8rem;
            }

            .symbol {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <div class="header">
            <h1>📊 Portfolio Table</h1>
            <p th:text="${timestamp}">Generated on: [timestamp]</p>
        </div>

        <!-- Summary Section -->
        <div class="summary-section" th:if="${portfolioData.summary}">
            <div class="summary-grid">
                <div class="summary-card">
                    <h3>Total Value</h3>
                    <div class="value" th:text="${#numbers.formatCurrency(portfolioData.summary.totalCurrentValue)}">$0.00</div>
                    <div class="vnd-value" th:text="${portfolioData.summary.totalCurrentValueVND}">₫0</div>
                </div>
                <div class="summary-card">
                    <h3>Initial Investment</h3>
                    <div class="value" th:text="${#numbers.formatCurrency(portfolioData.summary.totalInitialValue)}">$0.00</div>
                    <div class="vnd-value" th:text="${portfolioData.summary.totalInitialValueVND}">₫0</div>
                </div>
                <div class="summary-card">
                    <h3>Total P&L</h3>
                    <div class="value"
                         th:text="${#numbers.formatCurrency(portfolioData.summary.totalProfitLoss)}"
                         th:class="${portfolioData.summary.totalProfitLoss >= 0 ? 'positive' : 'negative'}">$0.00</div>
                    <div class="vnd-value"
                         th:text="${portfolioData.summary.totalProfitLossVND}"
                         th:class="${portfolioData.summary.totalProfitLoss >= 0 ? 'positive' : 'negative'}">₫0</div>
                </div>
                <div class="summary-card">
                    <h3>Total P&L %</h3>
                    <div class="value"
                         th:text="${#numbers.formatDecimal(portfolioData.summary.totalProfitLossPercentage, 1, 2)} + '%'"
                         th:class="${portfolioData.summary.totalProfitLossPercentage >= 0 ? 'positive' : 'negative'}">0.00%</div>
                </div>
                <div class="summary-card">
                    <h3>Holdings</h3>
                    <div class="value" th:text="${portfolioData.summary.numberOfHoldings}">0</div>
                </div>
            </div>
        </div>

        <!-- Portfolio Table -->
        <div class="portfolio-table">
            <table>
                <thead>
                    <tr>
                        <th>Asset</th>
                        <th>Holdings</th>
                        <th>Portfolio Weight</th>
                        <th>Avg Price</th>
                        <th>Current Price<br><span style="font-size: 0.7rem; opacity: 0.8;">(24h Change)</span></th>
                        <th>Initial Value</th>
                        <th>Current Value</th>
                        <th>P&L<br><span style="font-size: 0.7rem; opacity: 0.8;">($ / %)</span></th>
                        <th>Expected Entry</th>
                        <th>3M Target<br><span style="font-size: 0.7rem; opacity: 0.8;">(Distance)</span></th>
                        <th>Long Target<br><span style="font-size: 0.7rem; opacity: 0.8;">(Distance)</span></th>
                        <th>Support/Resistance</th>
                        <th>Stop Loss / Take Profit</th>
                        <th>Risk Level</th>
                        <th>Trend</th>
                        <th>Technical Indicators</th>
                        <th>Recommendation</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="row : ${portfolioData.portfolioRows}">
                        <!-- Asset Info -->
                        <td>
                            <div class="symbol" th:text="${row.symbol}">BTC</div>
                            <div class="crypto-name" th:text="${row.name}">Bitcoin</div>
                        </td>

                        <!-- Holdings Amount -->
                        <td class="value-cell" th:text="${#numbers.formatDecimal(row.holdings, 1, 6)}">0.000000</td>

                        <!-- Portfolio Weight -->
                        <td class="percentage-cell" th:text="${#numbers.formatDecimal(row.portfolioWeight, 1, 1)} + '%'">0.0%</td>

                        <!-- Average Price -->
                        <td class="price-cell" th:text="${#numbers.formatCurrency(row.averagePrice)}">$0.00</td>

                        <!-- Current Price with 24h Change -->
                        <td class="price-cell">
                            <div th:text="${#numbers.formatCurrency(row.currentPrice)}">$0.00</div>
                            <div class="percentage-cell"
                                 th:text="'(' + ${#numbers.formatDecimal(row.priceChange24h, 1, 2)} + '%)'"
                                 th:class="${row.priceChange24h >= 0 ? 'positive' : 'negative'}"
                                 style="font-size: 0.8rem;">(0.00%)</div>
                        </td>

                        <!-- Initial Value -->
                        <td class="value-cell" th:text="${#numbers.formatCurrency(row.initialValue)}">$0.00</td>

                        <!-- Current Value -->
                        <td class="value-cell" th:text="${#numbers.formatCurrency(row.currentValue)}">$0.00</td>

                        <!-- Combined P&L ($ / %) -->
                        <td class="value-cell">
                            <div th:text="${#numbers.formatCurrency(row.profitLoss)}"
                                 th:class="${row.profitLoss >= 0 ? 'positive' : 'negative'}">$0.00</div>
                            <div class="percentage-cell"
                                 th:text="'(' + ${#numbers.formatDecimal(row.profitLossPercentage, 1, 2)} + '%)'"
                                 th:class="${row.profitLossPercentage >= 0 ? 'positive' : 'negative'}"
                                 style="font-size: 0.8rem;">(0.00%)</div>
                        </td>

                        <!-- Expected Entry -->
                        <td class="price-cell" th:text="${#numbers.formatCurrency(row.expectedEntry)}">$0.00</td>

                        <!-- 3M Target with Distance -->
                        <td class="price-cell">
                            <div th:text="${#numbers.formatCurrency(row.targetPrice3Month)}">$0.00</div>
                            <div class="percentage-cell"
                                 th:text="'(' + ${#numbers.formatDecimal(row.distanceTo3MonthTarget, 1, 1)} + '%)'"
                                 th:class="${row.distanceTo3MonthTarget >= 0 ? 'positive' : 'negative'}"
                                 style="font-size: 0.8rem;">(0.0%)</div>
                        </td>

                        <!-- Long Target with Distance -->
                        <td class="price-cell">
                            <div th:text="${#numbers.formatCurrency(row.targetPriceLongTerm)}">$0.00</div>
                            <div class="percentage-cell"
                                 th:text="'(' + ${#numbers.formatDecimal(row.distanceToLongTarget, 1, 1)} + '%)'"
                                 th:class="${row.distanceToLongTarget >= 0 ? 'positive' : 'negative'}"
                                 style="font-size: 0.8rem;">(0.0%)</div>
                        </td>

                        <!-- Support/Resistance Levels -->
                        <td class="price-levels">
                            <div>S: <span class="support" th:text="${#numbers.formatCurrency(row.supportLevel)}">$0.00</span></div>
                            <div>R: <span class="resistance" th:text="${#numbers.formatCurrency(row.resistanceLevel)}">$0.00</span></div>
                        </td>

                        <!-- Stop Loss / Take Profit -->
                        <td class="price-levels">
                            <div>SL: <span class="stop-loss" th:text="${row.stopLossLevel}">$0.00</span></div>
                            <div>TP: <span class="take-profit" th:text="${row.takeProfitLevel}">$0.00</span></div>
                        </td>

                        <!-- Risk Level -->
                        <td>
                            <span th:class="'risk-' + ${#strings.toLowerCase(row.riskLevel)}"
                                  th:text="${row.riskLevel}">MEDIUM</span>
                        </td>

                        <!-- Trend -->
                        <td>
                            <span th:class="'trend-' + ${#strings.toLowerCase(row.trend)}"
                                  th:text="${row.trend}">SIDEWAYS</span>
                        </td>

                        <!-- Technical Indicators -->
                        <td class="technical-indicators">
                            <div th:if="${row.rsi != null}">RSI: <span th:text="${#numbers.formatDecimal(row.rsi, 1, 1)}">0.0</span></div>
                            <div th:if="${row.macd != null}">MACD: <span th:text="${#numbers.formatDecimal(row.macd, 1, 4)}">0.0000</span></div>
                            <div th:if="${row.sma20 != null}">SMA20: <span th:text="${#numbers.formatCurrency(row.sma20)}">$0.00</span></div>
                        </td>

                        <!-- Recommendation -->
                        <td>
                            <span class="recommendation"
                                  th:class="'rec-' + ${#strings.toLowerCase(#strings.replace(row.recommendation, '_', '-'))}"
                                  th:text="${#strings.replace(row.recommendation, '_', ' ')}">HOLD</span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>💡 This portfolio table provides comprehensive information about your cryptocurrency holdings including current market data, profit/loss calculations, target analysis, trends, and recommendations.</p>
            <p>⚠️ This information is for educational purposes only and should not be considered as financial advice.</p>
        </div>
    </div>
</body>
</html>
